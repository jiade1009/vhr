package org.javaboy.vhr.utils;

import org.javaboy.vhr.model.util.StockPositionVO;

import java.util.ArrayList;
import java.util.List;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 * @author : sam
 * @ClassName : StockPositionUtils
 * @description : 将从python端查询到的持仓结果的字符串格式，转换成对应的对象
 * @datetime : 2023年 02月 04日 15:34
 * @version: : 1.0
 */
public class StockPositionUtils {

    /**
     * 解析qmt客户端查询的股票持仓结果，将字符串转换成StockPosition列表
     * @param content 格式： [['a1', 'a2', 'a3'], ..., ['a1', 'a2', 'a3']]
     * @return
     */
    private static Pattern p = Pattern.compile("\\[(.*?)\\]");
    public static List<StockPositionVO> getStockPositionList(String content) {
        List<StockPositionVO> list = new ArrayList<>();
        content = content.substring(1, content.length()-1);
        Matcher m = p.matcher(content);
        while (m.find()) {
            // m.group(0) 是包含那两个字符，m.group(1) 不包含那两个字符
            String item = m.group(1);
            String[] arr = item.split(",");
            StockPositionVO vo = new StockPositionVO();
            vo.setCode(arr[7].substring(0, arr[7].length()-1).trim().substring(1));
            vo.setName(arr[8].substring(0, arr[8].length()-1).trim().substring(1));
            vo.setAmount(Integer.valueOf(arr[9].substring(0, arr[9].length()-1).trim().substring(1)));
            vo.setCost(Double.valueOf(arr[10].substring(0, arr[10].length()-1).trim().substring(1)));
            vo.setCostPrice(Double.valueOf(arr[11].substring(0, arr[11].length()-1).trim().substring(1)));
            vo.setProfitLoss(Double.valueOf(arr[12].substring(0, arr[12].length()-1).trim().substring(1)));
            vo.setMarketValue(Double.valueOf(arr[13].substring(0, arr[13].length()-1).trim().substring(1)));
            vo.setUsable(Integer.valueOf(arr[15].substring(0, arr[15].length()-1).trim().substring(1)));
            //盈亏比例字符串存在百分号，因此需要截取掉最后两个字符
            vo.setProfitLossRatio(Double.valueOf(arr[17].substring(0, arr[17].length()-2).trim().substring(1)));
            vo.setLastestPrice(Double.valueOf(arr[18].substring(0, arr[18].length()-1).trim().substring(1)));
            vo.setCurrentProfitLoss(Double.valueOf(arr[21].substring(0, arr[21].length()-1).trim().substring(1)));
            //当日涨幅字符串存在百分号，因此需要截取掉最后两个字符
            if (arr[25].length()<3) {  // 意外的字符格式： '-'
                vo.setCurrentIncrease(0d);
            } else {
                vo.setCurrentIncrease(Double.valueOf(arr[25].substring(0, arr[25].length()-2).trim().substring(1)));
            }
            list.add(vo);
        }
        return list;
    }

    public static void main(String[] args) {
        String content = "[['国金证券T2股票', '55002178', '55002178', '是', '', 'SH', '上证所', '600061', '国投资本', '4300', '29579.70', '6.88', '-167.70', '29412.00', 'A638606820', '4300', '0', '-0.57%', '6.84', '', '4300', '-258.00', '0.2939%', '5.9021%', '', '-0.87%', '4300', '2____10125____105210____49____55002178____', '2____10125____105210____49____55002178________SH____600061____48____49____1____48____456337079616345045'], ['国金证券T2股票', '55002178', '55002178', '是', '', 'SH', '上证所', '600070', '浙江富润', '5100', '29671.80', '5.82', '2050.20', '31722.00', 'A638606820', '5100', '0', '6.91%', '6.22', '', '5100', '-561.00', '0.3170%', '6.3663%', '', '-1.74%', '5100', '2____10125____105210____49____55002178____', '2____10125____105210____49____55002178________SH____600070____48____49____1____48____456337079616345045'], ['国金证券T2股票', '55002178', '55002178', '是', '', 'SH', '上证所', '600201', '生物股份', '2900', '29765.60', '10.26', '3352.40', '33118.00', 'A638606820', '2900', '0', '11.26%', '11.42', '', '2900', '174.00', '0.3310%', '6.6450%', '', '0.53%', '2900', '2____10125____105210____49____55002178____', '2____10125____105210____49____55002178________SH____600201____48____49____1____48____456337079616345045'], ['国金证券T2股票', '55002178', '55002178', '是', '', 'SH', '上证所', '600763', '通策医疗', '100', '16697.60', '166.98', '-400.60', '16297.00', 'A638606820', '100', '0', '-2.40%', '162.97', '', '100', '-73.00', '0.1629%', '3.2711%', '', '-0.45%', '100', '2____10125____105210____49____55002178____', '2____10125____105210____49____55002178________SH____600763____48____49____1____48____456337079616345045'], ['国金证券T2股票', '55002178', '55002178', '是', '', 'SH', '上证所', '603096', '新经典', '1400', '28375.20', '20.27', '352.80', '28728.00', 'A638606820', '1400', '0', '1.24%', '20.52', '', '1400', '-182.00', '0.2871%', '5.7662%', '', '-0.63%', '1400', '2____10125____105210____49____55002178____', '2____10125____105210____49____55002178________SH____603096____48____49____1____48____456337079616345045'], ['国金证券T2股票', '55002178', '55002178', '是', '', 'SZ', '深交所', '000627', '天茂集团', '9000', '29835.00', '3.32', '-135.00', '29700.00', '0156112218', '9000', '0', '-0.45%', '3.30', '', '9000', '-360.00', '0.2968%', '5.9613%', '', '-1.20%', '9000', '2____10125____105210____49____55002178____', '2____10125____105210____49____55002178________SZ____000627____48____49____1____48____2558537195607664707'], ['国金证券T2股票', '55002178', '55002178', '是', '', 'SZ', '深交所', '002081', '金 螳 螂', '10900', '59481.30', '5.46', '-512.30', '58969.00', '0156112218', '10900', '0', '-0.86%', '5.41', '', '10900', '-327.00', '0.5893%', '11.8361%', '', '-0.55%', '10900', '2____10125____105210____49____55002178____', '2____10125____105210____49____55002178________SZ____002081____48____49____1____48____2558537195607664707'], ['国金证券T2股票', '55002178', '55002178', '是', '', 'SZ', '深交所', '002926', '华西证券', '7100', '58717.00', '8.27', '497.00', '59214.00', '0156112218', '7100', '0', '0.85%', '8.34', '', '7100', '426.00', '0.5918%', '11.8834%', '', '0.72%', '7100', '2____10125____105210____49____55002178____', '2____10125____105210____49____55002178________SZ____002926____48____49____1____48____2558537195607664707'], ['国金证券T2股票', '55002178', '55002178', '是', '', 'SZ', '深交所', '002956', '西麦食品', '2000', '28660.00', '14.33', '1060.00', '29720.00', '0156112218', '2000', '0', '3.70%', '14.86', '', '2000', '620.00', '0.2970%', '5.9644%', '', '2.13%', '2000', '2____10125____105210____49____55002178____', '2____10125____105210____49____55002178________SZ____002956____48____49____1____48____2558537195607664707'], ['国金证券T2股票', '55002178', '55002178', '是', '', 'SZ', '深交所', '300132', '青松股份', '3800', '29488.00', '7.76', '494.00', '29982.00', '0156112218', '3800', '0', '1.68%', '7.89', '', '3800', '266.00', '0.2996%', '6.0179%', '', '0.90%', '3800', '2____10125____105210____49____55002178____', '2____10125____105210____49____55002178________SZ____300132____48____49____1____48____2558537195607664707'], ['国金证券T2股票', '55002178', '55002178', '是', '', 'SZ', '深交所', '300143', '盈康生命', '5000', '59105.00', '11.82', '-655.00', '58450.00', '0156112218', '5000', '0', '-1.11%', '11.69', '', '5000', '-450.00', '0.5841%', '11.7307%', '', '-0.76%', '5000', '2____10125____105210____49____55002178____', '2____10125____105210____49____55002178________SZ____300143____48____49____1____48____2558537195607664707'], ['国金证券T2股票', '55002178', '55002178', '是', '', 'SZ', '深交所', '300749', '顶固集创', '7400', '58830.00', '7.95', '1554.00', '60384.00', '0156112218', '7400', '0', '2.64%', '8.16', '', '7400', '0.00', '0.6035%', '12.1149%', '', '0.00%', '7400', '2____10125____105210____49____55002178____', '2____10125____105210____49____55002178________SZ____300749____48____49____1____48____2558537195607664707'], ['国金证券T2股票', '55002178', '55002178', '是', '', 'SZ', '深交所', '300770', '新媒股份', '400', '15793.20', '39.48', '162.80', '15956.00', '0156112218', '400', '0', '1.03%', '39.89', '', '400', '0.00', '0.1595%', '3.2026%', '', '2.84%', '400', '2____10125____105210____49____55002178____', '2____10125____105210____49____55002178________SZ____300770____48____49____1____48____2558537195607664707'], ['国金证券T2股票', '55002178', '55002178', '是', '', 'SH', '上证所', '600305', '恒顺醋业', '800', '9875.20', '12.34', '12.80', '9888.00', 'A638606820', '800', '0', '0.13%', '12.36', '', '800', '0.00', '0.0988%', '1.9847%', '', '-2.29%', '800', '2____10125____105210____49____55002178____', '2____10125____105210____49____55002178________SH____600305____48____49____1____48____456337079616345045'], ['国金证券T2股票', '55002178', '55002178', '是', '', 'SZ', '深交所', '300785', '值得买', '200', '6683.20', '33.42', '-7.20', '6676.00', '0156112218', '200', '0', '-0.11%', '33.38', '', '200', '0.00', '0.0667%', '1.3400%', '', '-1.10%', '200', '2____10125____105210____49____55002178____', '2____10125____105210____49____55002178________SZ____300785____48____49____1____48____2558537195607664707']]";
        getStockPositionList(content);
    }
}
